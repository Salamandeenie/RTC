<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Peer Connection Client</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        #container {
            text-align: center;
        }
        #ipDisplay {
            font-size: 24px;
            margin-bottom: 20px;
        }
        #status {
            margin-top: 20px;
            font-size: 18px;
        }
        input {
            padding: 10px;
            margin-top: 10px;
            width: 200px;
        }
        button {
            padding: 10px 15px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="ipDisplay">Your IP: <span id="ip"></span></div>
        <input type="text" id="targetIp" placeholder="Enter target IP" />
        <button id="getIpBtn">Get My IP</button>
        <button id="connectBtn">Connect to Target IP</button>
        <div id="status">Status: Not Connected</div>
    </div>

    <script>
        let localPeerConnection;
        let remotePeerConnection;

        // STUN server to get the public IP address
        const stunServer = {
            urls: 'stun:stun.l.google.com:19302'
        };

        // Function to get the public IP address using WebRTC
        function getPublicIP(callback) {
            const peerConnection = new RTCPeerConnection({ iceServers: [stunServer] });
            peerConnection.createDataChannel('dataChannel');
            peerConnection.createOffer().then(offer => {
                return peerConnection.setLocalDescription(offer);
            });

            peerConnection.onicecandidate = event => {
                if (event.candidate) {
                    const candidate = event.candidate.candidate;
                    const parts = candidate.split(' ');
                    const ip = parts[4]; // The public IP address
                    callback(ip);
                }
            };
        }

        // Display the IP address
        document.getElementById('getIpBtn').onclick = () => {
            getPublicIP(ip => {
                document.getElementById('ip').textContent = ip;
            });
        };

        // Connect to another peer
        document.getElementById('connectBtn').onclick = () => {
            const targetIp = document.getElementById('targetIp').value;
            if (!targetIp) {
                alert("Please enter a target IP address.");
                return;
            }

            localPeerConnection = new RTCPeerConnection({ iceServers: [stunServer] });
            remotePeerConnection = new RTCPeerConnection({ iceServers: [stunServer] });

            // Create data channel
            const dataChannel = localPeerConnection.createDataChannel('dataChannel');

            // When the remote peer receives an ICE candidate, add it to the remote peer connection
            localPeerConnection.onicecandidate = event => {
                if (event.candidate) {
                    remotePeerConnection.addIceCandidate(event.candidate);
                }
            };

            // When remote peer connection receives an ICE candidate
            remotePeerConnection.onicecandidate = event => {
                if (event.candidate) {
                    localPeerConnection.addIceCandidate(event.candidate);
                }
            };

            // Create offer and set local description
            localPeerConnection.createOffer().then(offer => {
                return localPeerConnection.setLocalDescription(offer);
            }).then(() => {
                return remotePeerConnection.setRemoteDescription(localPeerConnection.localDescription);
            }).then(() => {
                return remotePeerConnection.createAnswer();
            }).then(answer => {
                return remotePeerConnection.setLocalDescription(answer);
            }).then(() => {
                return localPeerConnection.setRemoteDescription(remotePeerConnection.localDescription);
            }).then(() => {
                // Successful connection
                document.body.style.backgroundColor = 'black';
                document.getElementById('status').textContent = 'Status: Connected';
            }).catch(error => {
                console.error('Error establishing connection:', error);
            });
        };
    </script>
</body>
</html>
