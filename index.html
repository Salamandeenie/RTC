<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetplayJS Example</title>
    <script src="https://unpkg.com/netplayjs@0.4.1/dist/netplay.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: black;
        }
        canvas {
            position: absolute;
            opacity: 1;
            transition: opacity 0.5s;
        }
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1; /* Ensure buttons are above canvas */
        }
        button {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="controls">
        <button id="timeButton">Show Time</button>
        <button id="colorButton">Change Background Color</button>
    </div>

    <script>
        class SimpleGame extends netplayjs.Game {
            constructor() {
                super();
                this.color = 'black'; // Default background color
            }

            // Wait for connections
            onConnected() {
                // Set canvas opacity to 0 to reveal buttons
                document.getElementById('gameCanvas').style.opacity = '0';
            }

            // Draw the current state of the game to a canvas.
            draw(canvas) {
                const ctx = canvas.getContext("2d");
                ctx.fillStyle = this.color; // Use the chosen color
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // Function to update the background color
            updateColor(color) {
                this.color = color;
            }
        }

        SimpleGame.timestep = 1000 / 60; // 60 FPS
        SimpleGame.canvasSize = { width: 600, height: 300 };

        // Create and start the game
        const gameInstance = new netplayjs.RollbackWrapper(SimpleGame);
        
        // Set up button functionality
        document.getElementById('timeButton').addEventListener('click', () => {
            const now = new Date().toLocaleTimeString();
            gameInstance.players.forEach(player => {
                player.sendMessage(`Current time: ${now}`);
            });
            console.log(`Current time: ${now}`);
        });

        document.getElementById('colorButton').addEventListener('click', () => {
            const newColor = 'lime'; // Change to lime
            gameInstance.players.forEach(player => {
                player.sendMessage(`Change color: ${newColor}`);
                gameInstance.updateColor(newColor); // Update color on all instances
            });
            console.log(`Background color changed to: ${newColor}`);
        });

        gameInstance.start();

        // Handle incoming messages from other players
        gameInstance.onMessage((player, message) => {
            if (message.startsWith('Current time:')) {
                console.log(message); // Log received time message
            } else if (message.startsWith('Change color:')) {
                const color = message.split(': ')[1];
                gameInstance.updateColor(color); // Update the color based on the message
            }
        });
    </script>
</body>
</html>
