<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetplayJS Example</title>
    <script src="https://unpkg.com/netplayjs@0.4.1/dist/netplay.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: black;
        }
        canvas {
            position: absolute;
            opacity: 1;
            transition: opacity 0.5s;
            background: black; /* Default canvas background */
        }
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1; /* Ensure buttons are above canvas */
        }
        button {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="controls">
        <button id="timeButton">Show Time</button>
        <button id="colorButton">Change Background Color</button>
    </div>

    <script>
        class SimpleGame extends netplayjs.Game {
            constructor() {
                super();
                this.color = 'black'; // Default background color
                this.width = 600; // Set canvas width
                this.height = 300; // Set canvas height
            }

            onConnected() {
                // Set canvas opacity to 0 to reveal buttons
                document.getElementById('gameCanvas').style.opacity = '0';
                console.log("Connected to another player.");
            }

            draw(canvas) {
                const ctx = canvas.getContext("2d");
                ctx.fillStyle = this.color; // Use the chosen color
                ctx.fillRect(0, 0, this.width, this.height);
            }

            // Function to update the background color
            updateColor(color) {
                this.color = color;
            }
        }

        SimpleGame.timestep = 1000 / 60; // 60 FPS
        SimpleGame.canvasSize = { width: 600, height: 300 };

        // Create and start the game
        const gameInstance = new netplayjs.RollbackWrapper(SimpleGame);
        
        // Set up button functionality
        document.getElementById('timeButton').addEventListener('click', () => {
            const now = new Date().toLocaleTimeString();
            console.log(`Current time: ${now}`); // Log current time

            // Send time message to the other player
            gameInstance.players.forEach(player => {
                player.sendMessage(`TIME:${now}`);
            });
        });

        document.getElementById('colorButton').addEventListener('click', () => {
            const newColor = 'lime'; // Change to lime
            console.log(`Changing color to: ${newColor}`);
            
            // Send color change message to the other player
            gameInstance.players.forEach(player => {
                player.sendMessage(`COLOR:${newColor}`);
            });
            gameInstance.updateColor(newColor); // Update color on local instance
        });

        gameInstance.start();

        // Handle incoming messages from other players
        gameInstance.onMessage((player, message) => {
            if (message.startsWith('TIME:')) {
                const time = message.split(':')[1];
                console.log(`Received time: ${time}`);
                alert(`Other player's time: ${time}`);
            } else if (message.startsWith('COLOR:')) {
                const color = message.split(':')[1];
                console.log(`Received color change to: ${color}`);
                gameInstance.updateColor(color); // Update color based on the message
            }
        });

        gameInstance.onDisconnected(() => {
            console.log("Disconnected from the other player.");
        });
    </script>
</body>
</html>
